# Studio - 패치노트

## 버전 2.2.2 (2024.12.21) - 댓글 시스템 버그 수정

### 🐛 버그 수정

#### 1. ✅ 주석 오버레이 표시 문제 해결
- **문제**: 댓글에서 "아트워크 주석" 또는 "초안 주석" 버튼 클릭 시 반응 없음
- **원인**: 
  - `toggleAnnotationOverlay` 함수가 SceneView에 정의되지 않음
  - 이미지 뷰에서 주석 오버레이 표시 로직 누락
- **해결**: 
  - SceneView에 `toggleSketchOverlay`와 `toggleAnnotationOverlay` 함수 추가
  - 초안과 아트워크 이미지에 주석 오버레이 표시 코드 추가
  - 주석 데이터가 있는 경우 mixBlendMode: 'multiply'로 오버레이 표시
- **결과**: 주석 버튼 클릭 시 해당 이미지 위에 주석이 정상적으로 표시됨

#### 2. ✅ 단축키 안내 툴팁 위치 개선
- **문제**: 수정요청 태그 호버 시 단축키 안내창이 버튼을 가림
- **원인**: 툴팁이 우측 하단(right-4)에 고정되어 댓글 입력란과 겹침
- **해결**: 
  - 툴팁 위치를 좌측 하단(left-4)으로 변경
  - `pointer-events-none hover:pointer-events-auto` 추가로 의도치 않은 간섭 방지
- **결과**: 툴팁이 UI 요소를 가리지 않고 필요시에만 상호작용 가능

#### 3. ✅ 수정요청 필터 작동 문제 해결
- **문제**: 댓글 필터에서 "수정요청" 선택 시 모든 댓글이 사라짐
- **원인**: CommentSection에서 중복 필터링으로 인한 로직 충돌
- **해결**: 
  - CommentSection의 중복 필터링 로직 제거
  - 상위 컴포넌트(SceneView)에서 이미 필터링된 댓글 전달
  - useComments 훅의 getFilteredComments 함수 활용
- **결과**: 필터가 정상적으로 작동하여 선택한 타입의 댓글만 표시

---

### 🔧 기술적 상세사항

#### 수정된 파일
1. **SceneView.tsx**
   - `toggleSketchOverlay`, `toggleAnnotationOverlay` 함수 추가
   - 이미지 렌더링 섹션에 주석 오버레이 표시 로직 추가
   - 단축키 툴팁 위치 및 스타일 수정

2. **CommentSection.tsx**
   - 중복 필터링 로직 제거
   - props로 전달받은 필터링된 댓글 직접 사용

#### 코드 변경 사항
```typescript
// 1. 오버레이 토글 함수 추가
const toggleAnnotationOverlay = useCallback((commentId: number) => {
  setShowAnnotationOverlay(showAnnotationOverlay === commentId ? null : commentId);
}, [showAnnotationOverlay]);

// 2. 이미지에 주석 오버레이 추가
{showAnnotationOverlay && comments.find(c => c.id === showAnnotationOverlay && c.imageType === 'sketch')?.annotationData && (
  <div className="absolute inset-0 pointer-events-none">
    <img
      src={comments.find(c => c.id === showAnnotationOverlay)?.annotationData}
      alt="주석 오버레이"
      className="w-full h-full object-contain"
      style={{ mixBlendMode: 'multiply' }}
    />
  </div>
)}

// 3. 툴팁 위치 변경
<div className="fixed bottom-4 left-4 bg-black text-white p-3 rounded-lg text-xs space-y-1 opacity-0 hover:opacity-100 transition-opacity pointer-events-none hover:pointer-events-auto">
```

---

### 📊 영향 범위
- 모든 프로젝트의 주석 기능 정상화
- UI/UX 개선으로 사용자 경험 향상
- 필터링 시스템의 안정성 향상

---

### 🎯 현재 상태
- ✅ 주석 오버레이 기능 정상 작동
- ✅ 단축키 툴팁이 다른 UI 요소를 가리지 않음
- ✅ 댓글 필터링 시스템 정상 작동
- ✅ 모든 기존 기능 유지

---

### 🔄 다음 업데이트 예정
- [ ] 주석 편집 기능 추가
- [ ] 주석 색상 커스터마이징
- [ ] 주석 레이어 관리 시스템
- [ ] 댓글 정렬 옵션 추가

---

### 💡 사용 팁

#### 주석 오버레이 사용법
1. 댓글 목록에서 주석이 포함된 댓글 찾기
2. "초안 주석" 또는 "아트워크 주석" 버튼 클릭
3. 해당 이미지 위에 주석이 오버레이로 표시
4. 다시 클릭하면 오버레이 숨김

#### 필터 사용법
1. 댓글 탭 상단의 드롭다운 메뉴 클릭
2. 원하는 댓글 타입 선택:
   - 모든 댓글: 전체 댓글 표시
   - 일반 댓글: 일반 댓글만 표시
   - 수정요청: 수정요청 태그가 달린 댓글만 표시
   - 주석: 주석이 포함된 댓글만 표시

---

### ⚠️ 주의사항
- 주석 오버레이는 원본 이미지 위에 multiply 블렌드 모드로 표시됩니다
- 큰 이미지의 경우 주석 로딩에 시간이 걸릴 수 있습니다

---

### 🙏 피드백
버그 리포트나 기능 제안은 GitHub Issues를 통해 제출해주세요.

---

**Last Updated**: 2024.12.21  
**Current Version**: 2.2.2  
**Status**: Production Ready ⚡  
**GitHub Repository**: https://github.com/gatat123/art  
**Production URL**: https://art-production-a9ab.up.railway.app/

---

**© 2024 Studio. All rights reserved.**