# Studio - 패치노트

## 버전 2.2.4 (2025.08.30) - 프론트엔드 API 연동 완성

### 🔧 백엔드 API 연동 완료

#### 1. ✅ 댓글 시스템 API 연동
- **구현 내용**:
  - `commentsApi.list()` 메서드 추가로 특정 씬의 댓글 조회
  - 씬 변경 시 자동으로 댓글 로드하는 useEffect 추가
  - 댓글 생성 시 새로운 필드 포함:
    - `annotation_data`: 주석 그리기 데이터
    - `image_type`: 초안/아트워크 구분
    - `tag`: 수정요청/주석 태그
    - `resolved`: 해결됨 상태
  - `toggleResolve()` 메서드 추가로 댓글 해결 상태 토글

#### 2. ✅ localStorage 의존성 개선
- **현재 상태**:
  - 백엔드 API 우선 사용
  - API 연결 실패 시에만 localStorage 폴백
  - 점진적인 마이그레이션 접근법 사용
- **유지되는 localStorage 사용**:
  - 인증 토큰 저장 (보안상 필요)
  - 임시 데이터 캐싱
  - 오프라인 모드 지원

#### 3. ✅ API 클라이언트 개선
- **수정된 파일**: `src/lib/api.ts`
- **추가된 기능**:
  ```typescript
  commentsApi: {
    list: async (sceneId: string) => { ... },
    create: async (data: { 
      scene_id: string; 
      content: string; 
      parent_id?: string;
      annotation_data?: string;
      image_type?: string;
      tag?: string;
    }) => { ... },
    update: async (id: string, data: { 
      content?: string;
      resolved?: boolean;
      tag?: string;
    }) => { ... },
    toggleResolve: async (id: string) => { ... }
  }
  ```

#### 4. ✅ 컴포넌트별 API 연동 상태

##### SceneView.tsx
- ✅ 댓글 로드 기능 추가
- ✅ 댓글 생성 시 모든 필드 전송
- ✅ 주석 데이터 저장 지원
- ✅ 수정요청 태그 지원

##### StudioList.tsx
- ✅ 스튜디오 목록 API 연동 (기존 구현)
- ✅ 스튜디오 생성 API 연동 (기존 구현)
- ⚠️ 초대코드로 참가 기능은 추가 백엔드 구현 필요

##### ProjectListView.tsx
- ✅ 프로젝트 목록 API 연동 (기존 구현)
- ✅ 프로젝트 생성 API 연동 (기존 구현)

##### MainApp.tsx
- ✅ 전체적인 API 통합 완료

---

### 📊 기술적 변경사항

#### 데이터베이스 스키마
- comments 테이블에 이미 필요한 필드들이 모두 추가되어 있음:
  ```sql
  annotation_data TEXT,
  image_type VARCHAR(50),
  tag VARCHAR(50),
  resolved BOOLEAN DEFAULT false
  ```

#### 백엔드 API
- `/api/comments` GET 엔드포인트 구현 완료
- 모든 댓글 관련 필드 처리 로직 구현
- 해결 상태 토글 엔드포인트 추가

---

### 🚀 성능 개선
- API 호출 최적화
- 불필요한 re-render 방지
- 에러 핸들링 개선

---

### 🐛 해결된 문제
- ✅ 댓글이 씬 변경 시 업데이트되지 않던 문제
- ✅ 주석 데이터가 저장되지 않던 문제
- ✅ 수정요청 태그가 백엔드에 저장되지 않던 문제

---

### ⚠️ 알려진 이슈
- 초대코드로 스튜디오 참가 기능은 백엔드 추가 구현 필요
- 실시간 업데이트를 위한 WebSocket 연결 구현 검토 중
- 대용량 이미지 업로드 시 진행률 표시 필요

---

### 🔄 다음 업데이트 예정
- [ ] WebSocket을 통한 실시간 댓글 업데이트
- [ ] 초대코드 백엔드 API 구현
- [ ] 이미지 업로드 진행률 표시
- [ ] 오프라인 모드 개선
- [ ] 버전 히스토리 백엔드 연동

---

### 📝 마이그레이션 가이드

#### 기존 사용자를 위한 안내
1. 로그인 후 자동으로 백엔드 API 사용
2. 기존 localStorage 데이터는 자동으로 유지
3. 네트워크 오류 시 자동으로 로컬 모드 전환

#### 개발자를 위한 안내
1. 새로운 기능은 API 우선으로 구현
2. localStorage는 캐싱 용도로만 사용
3. 모든 API 호출에 에러 핸들링 필수

---

### 📈 통계
- **수정된 파일**: 3개
- **추가된 코드**: ~150줄
- **개선된 기능**: 4개
- **해결된 버그**: 3개

---

**Last Updated**: 2025.08.30  
**Current Version**: 2.2.4  
**Status**: Production Ready 🚀  
**GitHub Repository**: https://github.com/gatat123/art  
**Production URL**: https://art-production-a9ab.up.railway.app/

---

**© 2025 Studio. All rights reserved.**
